<body style="background-color: beige;">
  <div class="main-banner wow fadeIn" id="top">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="form-container" style="padding-top: 5%;">
            <h2>PHI·∫æU XU·∫§T H√ÄNG - WAREHOUSE MANAGER T&H</h2>

             <div class="header-top">
              <button type="button" (click)="resetForm()" class="btn-reset">üîÑ T·∫°o l·∫°i</button>
            </div>

            <form (ngSubmit)="submitForm()" enctype="multipart/form-data">

              <!-- Ng√†y t·∫°o + M√£ phi·∫øu -->
              <div class="row">
                <label>Ng√†y t·∫°o:</label>
                <input type="date" [(ngModel)]="formData.created_date" name="created_date" readonly>

                <label style="margin-left: 20px;">M√£ phi·∫øu:</label>
                <input type="text" [value]="generatedReceiptCode || 'ƒêang t·∫°o...'" readonly>
              </div>

              <!-- T√™n t·ªï ch·ª©c -->
              <div class="row">
                <label>T√™n ng∆∞·ªùi ƒë·∫∑t h√†ng / doanh nghi·ªáp / ƒë∆°n v·ªã, ...</label>
                <input type="text" [(ngModel)]="formData.receiver_name" name="receiver_name" required (ngModelChange)="onFormChange()">
              </div>

              <!-- Logo -->
              <div class="row">
                <label>Logo (n·∫øu c√≥):</label>
                <input type="file" accept="image/*" (change)="onLogoChange($event)" />

                <div *ngIf="formData.logoPreview" class="preview-wrapper">
                  <img [src]="formData.logoPreview" class="preview-img" alt="Logo preview" />
                  <button type="button" class="btn-remove" (click)="goLogo()">‚ùå</button>
                </div>
              </div>


              <!-- ƒê·ªãa ch·ªâ -->
              <div class="row">
                <label>ƒê·ªãa ch·ªâ giao h√†ng:</label>
                <input type="text" [(ngModel)]="formData.receiver_address" name="receiver_address" required (ngModelChange)="onFormChange()">
              </div>

              

              <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
              <!-- Th√¥ng tin ƒë·∫°i di·ªán nh√† cung c·∫•p -->
              <div class="info-card">
                <h4>Th√¥ng tin li√™n l·∫°c kh√°ch h√†ng</h4>
                <div class="row">
                  <label>H·ªç v√† t√™n </label>
                  <input type="text" [(ngModel)]="formData.representative_name" name="representative_name" required (ngModelChange)="onFormChange()">
                </div>

                <div class="row">
                  <label>Email :</label>
                  <input type="email" [(ngModel)]="formData.representative_email" name="representative_email" required (ngModelChange)="onFormChange()">
                </div>

                <div class="row">
                  <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                  <input type="text" [(ngModel)]="formData.representative_phone" name="representative_phone" required (ngModelChange)="onFormChange()">
                </div>
              </div>

              <!-- L∆∞u √Ω -->
              <div class="alert alert-warning">
                <strong>L∆∞u √Ω:</strong> Phi·∫øu ch·ªâ ƒë∆∞·ª£c g·ª≠i khi b·∫°n c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin nh√¢n vi√™n.
              </div>

              <div class="info-card">
                <!-- T√™n nh√¢n vi√™n -->
                <div class="row">
                  <label>T√™n nh√¢n vi√™n t·∫°o phi·∫øu</label>
                  <input type="text" [value]="userInfo.full_name" readonly>
                </div>
                
                <!-- T√†i kho·∫£n nh√¢n vi√™n-->
                <div class="row">
                  <label>T√†i kho·∫£n nh√¢n vi√™n t·∫°o phi·∫øu</label>
                  <input type="text" [value]="userEmail" readonly>
                </div>
              </div>

              <!-- Danh s√°ch s·∫£n ph·∫©m -->
              <h4>Danh s√°ch s·∫£n ph·∫©m</h4>
              <div style="overflow-x: auto;" class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>STT</th>
                      <th>H√¨nh ·∫£nh</th>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th>Lo·∫°i</th>
                      <th>M√£ SP</th>
                      <th>ƒê∆°n v·ªã</th>
                      <th>T·ªïng tr·ªçng l∆∞·ª£ng</th>
                      <th>Tr·ªçng l∆∞·ª£ng 1 ƒë∆°n v·ªã</th>
                      <th>NSX</th>
                      <th>HSD</th>
                      <th>T·ªìn kho</th>
                      <th>S·ªë l∆∞·ª£ng mua</th>
                      <th>ƒê∆°n gi√°</th>
                      <th>Th√†nh ti·ªÅn</th>
                      <th>Xo√°</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of formData.products; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>
                        <img *ngIf="item.preview" [src]="item.preview" class="preview-img-small">
                      </td>
                      <td>{{ item.product_name }}</td>
                      <td>{{ item.product_type }}</td>
                      <td>{{ item.product_code }}</td>
                      <td>{{ item.unit }}</td>
                      <td>{{ item.weight | number:'1.2-2' }} kg</td>
                      <td>{{ item.weight_per_unit | number:'1.2-2' }} kg</td>
                      <td>{{ item.manufacture_date | date:'dd/MM/yyyy' }}</td>
                      <td>{{ item.expiry_date | date:'dd/MM/yyyy' }}</td>
                      <td>{{ item.original_quantity }}</td>  <!-- Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng t·ªìn kho g·ªëc -->
                      <td>
                        <input [(ngModel)]="item.quantity"
                               name="quantity{{i}}"
                               type="number"
                               required min="1"
                               (ngModelChange)="onQuantityChange(i)">
                      </td>
                      <td>{{ item.unit_price | number:'1.0-0' }} ƒë</td>
                      <td>{{ item.quantity * item.unit_price | number:'1.0-0' }} ƒë</td>
                      <td><button type="button" (click)="removeProduct(i)">‚ùå</button></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Th√™m s·∫£n ph·∫©m -->
              <button type="button" (click)="goToSanPhamCuakho()">Th√™m s·∫£n ph·∫©m</button>

              <br><br>

              <!-- T·ªïng c·ªông -->
              <div class="row total-row">
                <label>T·ªïng c·ªông: <span>{{ calculateTotal() | number:'1.0-0' }} VNƒê</span></label>
              </div>

              <!-- T·ªïng tr·ªçng l∆∞·ª£ng -->
              <div class="row total-row">
                <label>T·ªïng tr·ªçng l∆∞·ª£ng ƒë∆°n h√†ng: 
                  <span>{{ calculateTotalWeight() | number:'1.2-2' }} kg</span>
                </label>
              </div>

              <!-- Ng√†y h·∫πn g·∫∑p m·∫∑t -->
              <div class="row">
                <label>Ng√†y xu·∫•t kho:</label>
                <input type="date" [(ngModel)]="formData.appointment_date" name="delivery_date" required>
              </div>

              <!-- Ghi ch√∫ -->
              <div class="row">
                <label>Ghi ch√∫ cho qu·∫£n l√Ω kho (n·∫øu c√≥):</label>
                <textarea rows="4" [(ngModel)]="formData.note" name="note" placeholder="Ghi ch√∫ th√™m..." (ngModelChange)="onFormChange()"></textarea>
              </div>

              <!-- G·ª≠i -->
              <button type="submit" class="submit-btn">‚úÖ G·ª≠i phi·∫øu xu·∫•t h√†ng</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
