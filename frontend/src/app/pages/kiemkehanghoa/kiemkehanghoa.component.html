<body style="background-color: beige;">
  <div class="container mt-4">
    <h2 class="mb-3">
      ğŸ“‹ Kiá»ƒm kÃª hÃ ng hÃ³a
    </h2>

    <div class="alert alert-secondary">
      <h4><strong>ğŸ“Œ MÃ£ Ä‘á»£t:&nbsp;</strong> <span class="text-danger">{{ maDot || '...' }}</span> &nbsp; | &nbsp;
      <strong>ğŸ“ TÃªn Ä‘á»£t:&nbsp;</strong> <span class="text-primary">{{ tenDot || '...' }}</span> &nbsp; | &nbsp;
      <strong>ğŸ“… NgÃ y táº¡o:&nbsp;</strong> <span class="text-success">{{ ngayTaoDot || '...' }}</span></h4>
    </div>

    <!-- Bá»™ lá»c -->
    <div class="row mb-3">
      <div class="col-md-2">
        <input type="text" class="form-control" placeholder="ğŸ” MÃ£ SP" [(ngModel)]="filter.ma" (input)="locDanhSach()" />
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" placeholder="ğŸ” TÃªn SP" [(ngModel)]="filter.ten" (input)="locDanhSach()" />
      </div>
      <div class="col-md-2">
        <select class="form-control" [(ngModel)]="filter.khuVuc" (change)="locDanhSach()">
          <option value="">ğŸ“ Táº¥t cáº£ khu vá»±c</option>
          <option *ngFor="let kv of danhSachKhuVuc" [value]="kv">{{ kv }}</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-control" [(ngModel)]="filter.tinhTrang" (change)="locDanhSach()">
          <option value="">ğŸ“Š TÃ¬nh tráº¡ng</option>
          <option value="du">ğŸŸ¢ Äá»§</option>
          <option value="thieu">ğŸ”´ Thiáº¿u</option>
          <option value="du_thua">ğŸŸ¡ DÆ°</option>
          <option value="chua_kiem">â³ ChÆ°a kiá»ƒm</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" placeholder="ğŸ‘¤ Email kiá»ƒm kÃª" [(ngModel)]="filter.email" (input)="locDanhSach()" />
      </div>
    </div>



    <div *ngIf="danhSachCanDem.length === 0 && dotId !== 0" class="alert alert-info text-center">
      KhÃ´ng cÃ³ sáº£n pháº©m nÃ o Ä‘Æ°á»£c gÃ¡n cho Ä‘á»£t kiá»ƒm kÃª nÃ y hoáº·c Ä‘Ã£ hoÃ n táº¥t.
    </div>
    <div *ngIf="dotId === 0" class="alert alert-danger text-center">
        ChÆ°a cÃ³ Ä‘á»£t kiá»ƒm kÃª nÃ o Ä‘Æ°á»£c táº¡o hoáº·c Ä‘Ã£ hoÃ n táº¥t.
    </div>

    <table class="table table-bordered table-hover" *ngIf="danhSachCanDem.length > 0">
      <thead class="table-light">
        <tr>
          <th class="th-auto-width">HÃ¬nh</th>
          <th class="th-auto-width">MÃ£ sáº£n pháº©m</th>
          <th class="th-auto-width">TÃªn sáº£n pháº©m</th>
          <th class="th-auto-width">Khu vá»±c</th>
          <th class="th-auto-width">Tá»“n kho</th>
          <th class="th-auto-width">Thá»±c táº¿</th>
          <th class="th-auto-width">TÃ¬nh tráº¡ng</th>
          <th class="th-auto-width">Ghi chÃº</th>
          <th class="th-auto-width">NhÃ¢n viÃªn</th>
          <th class="th-auto-width">Thao tÃ¡c</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let sp of danhSachCanDem">
          <tr (click)="moPopupChiTiet(sp)" style="cursor: pointer;">
            <td><img [src]="sp.image_url" width="50" /></td>
            <td>{{ sp.product_code }}</td>
            <td>{{ sp.product_name }}</td>
            <td>{{ sp.ten_khu_vuc }}</td>
            <td><strong>{{ sp.system_quantity }}</strong></td>
            <td (click)="$event.stopPropagation()">
              <input
                type="number"
                [(ngModel)]="sp.actual_quantity"
                (ngModelChange)="onChangeSoLuong(sp)"
                class="form-control form-control-sm"
                [disabled]="sp.checked_by_email && sp.checked_by_email !== email"
              />
            </td>
            <td [ngClass]="getClassTinhTrang(sp)">
              {{ tinhTrang(sp) }}
            </td>
            <td (click)="$event.stopPropagation()">
              <input
                type="text"
                [(ngModel)]="sp.ghi_chu"
                class="form-control form-control-sm"
                [readonly]="!sp.actual_quantity"
                (ngModelChange)="onChangeSoLuong(sp)"
                placeholder="Ghi chÃº"
              />
            </td>
            <td>
              <!-- Æ¯u tiÃªn hiá»ƒn thá»‹ email táº¡m náº¿u actual_quantity vá»«a thay Ä‘á»•i -->
              <span *ngIf="sp.temp_email" class="text-muted">
                {{ sp.temp_email }} (chÆ°a lÆ°u)
              </span>

              <!-- Chá»‰ hiá»ƒn thá»‹ email Ä‘Ã£ lÆ°u náº¿u khÃ´ng cÃ³ temp_email -->
              <span *ngIf="!sp.temp_email && sp.checked_by_email" class="text-success">
                {{ sp.checked_by_email }}
              </span>
            </td>
            <td (click)="$event.stopPropagation()">
              <button class="btn btn-sm"
                      [disabled]="sp.checked_by_email && sp.checked_by_email !== email"
                      [ngClass]="{
                        'btn-secondary': sp.checked_by_email && sp.checked_by_email !== email,
                        'btn-warning': sp.checked_by_email && sp.checked_by_email === email,
                        'btn-success': !sp.checked_by_email
                      }"
                      (click)="xacNhanMotSanPham(sp)">
                {{ sp.checked_by_email ? 'Cáº­p nháº­t' : 'HoÃ n táº¥t' }}
              </button>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
    
  </div>

  <div class="modal" tabindex="-1" [ngClass]="{ 'show d-block': popupChiTiet }" style="background-color: rgba(0,0,0,0.3);">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ğŸ“¦ ThÃ´ng tin chi tiáº¿t: {{ sanPhamDangXem?.product_code }}</h5>
          <button type="button" class="btn-close" (click)="popupChiTiet = false"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-4 text-center">
              <img [src]="sanPhamDangXem?.image_url" class="img-fluid rounded" style="max-height: 150px;" />
            </div>
            <div class="col-md-8">
              <p><strong>TÃªn sáº£n pháº©m:</strong> {{ sanPhamDangXem?.product_name }}</p>
              <p><strong>Khu vá»±c:</strong> {{ sanPhamDangXem?.ten_khu_vuc }}</p>
              <p><strong>Sá»‘ lÆ°á»£ng há»‡ thá»‘ng:</strong> {{ sanPhamDangXem?.system_quantity }}</p>
            </div>
          </div>
          <hr />
          <h6>ğŸ“ CÃ¡c pallet chá»©a mÃ£ nÃ y (táº¡i thá»i Ä‘iá»ƒm Admin gÃ¡n Ä‘á»£t):</h6>
          <ul *ngIf="sanPhamDangXem?.pallets?.length > 0">
            <li *ngFor="let p of sanPhamDangXem.pallets">
              {{ p.location }} â€“ SL: {{ p.quantity }}
            </li>
          </ul>
          <div *ngIf="!sanPhamDangXem?.pallets?.length" class="text-muted">âŒ KhÃ´ng tÃ¬m tháº¥y pallet chá»©a sáº£n pháº©m.</div>
        </div>
      </div>
    </div>
  </div>
</body>