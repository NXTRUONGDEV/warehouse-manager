
<body style="background-color: beige;">

  <div class="main-banner wow fadeIn" id="top" data-wow-duration="1s" data-wow-delay="0.5s">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
            <div class="main-banner wow fadeIn" id="top">
            <div class="container">
              <div class="row">
                <div class="col-lg-12">
                  
                <div class="invoice-container">
                  <div class="filter-section">
                    <!-- H√†ng tr√™n: 3 b·ªô l·ªçc ch√≠nh -->
                    <div class="filter-row">
                      <label>M√£ phi·∫øu:
                        <input [(ngModel)]="filter.keyword" (input)="locHoaDon()" />
                      </label>
                      <label>Lo·∫°i phi·∫øu:
                        <select [(ngModel)]="filter.loai" (change)="locHoaDon()">
                          <option value="">T·∫•t c·∫£</option>
                          <option value="Phi·∫øu nh·∫≠p kho">Phi·∫øu nh·∫≠p kho</option>
                          <option value="Phi·∫øu xu·∫•t kho">Phi·∫øu xu·∫•t kho</option>
                        </select>
                      </label>
                      <label>Tr·∫°ng th√°i:
                        <select [(ngModel)]="filter.trangThai" (change)="locHoaDon()">
                          <option value="">T·∫•t c·∫£</option>
                          <option value="ƒê√£ g·ª≠i phi·∫øu">ƒê√£ g·ª≠i phi·∫øu</option>
                          <option value="ƒê√£ duy·ªát">ƒê√£ duy·ªát</option>
                          <option value="ƒê√£ h·ªßy">ƒê√£ h·ªßy</option>
                          <option value="ƒê√£ nh·∫≠p h√†ng v√†o kho">ƒê√£ nh·∫≠p h√†ng v√†o kho</option>
                          <option value="ƒê√£ xu·∫•t h√†ng kh·ªèi kho">ƒê√£ xu·∫•t h√†ng kh·ªèi kho</option>
                        </select>
                      </label>
                    </div>

                    <!-- H√†ng d∆∞·ªõi: Ng√†y t·∫°o + T·ªïng ti·ªÅn -->
                    <div class="filter-row">
                      <label>üìÖ Ng√†y t·∫°o t·ª´:
                        <input type="date" [(ngModel)]="filter.ngayBatDau" (change)="locHoaDon()" />
                      </label>
                      <label>ƒë·∫øn:
                        <input type="date" [(ngModel)]="filter.ngayKetThuc" (change)="locHoaDon()" />
                      </label>
                      <label>üí∞ T·ªïng ti·ªÅn t·ª´:
                        <input type="number" [(ngModel)]="filter.tongTienMin" (input)="locHoaDon()" />
                      </label>
                      <label>ƒë·∫øn:
                        <input type="number" [(ngModel)]="filter.tongTienMax" (input)="locHoaDon()" />
                      </label>
                    </div>
                  </div>

                  <br>

                  <h2>üìë H√≥a ƒë∆°n t·ªïng h·ª£p</h2>
                  <table class="invoice-table">
                    <thead>
                      <tr>
                        <th>Lo·∫°i phi·∫øu</th>
                        <th>M√£ phi·∫øu</th>
                        <th>Ng√†y t·∫°o</th>
                        <th>T·ªïng ti·ªÅn</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Chi ti·∫øt</th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngFor="let hd of filteredHoaDonList">
                        <!-- D√≤ng h√≥a ƒë∆°n -->
                        <tr>
                          <td>{{ hd.loai }}</td>
                          <td>{{ hd.receipt_code }}</td>
                          <td>{{ hd.created_date | date:'dd/MM/yyyy' }}</td>
                          <td>{{ hd.total_amount | number:'1.0-0' }} VNƒê</td>
                          <td>
                            <span [ngClass]="{
                              'status-duyet': hd.trang_thai === 'ƒê√£ duy·ªát',
                              'status-hoanthanh': hd.trang_thai === 'ƒê√£ nh·∫≠p h√†ng v√†o kho' || hd.trang_thai === 'ƒê√£ xu·∫•t h√†ng kh·ªèi kho',
                              'status-huy': hd.trang_thai === 'ƒê√£ h·ªßy'
                            }">
                              {{ hd.trang_thai }}
                            </span>
                          </td>
                          <div class="btn-wrapper">
                              <button class="btn-view" (click)="xemChiTietHoaDon(hd)">
                                üîç Xem
                              </button>
                              <span 
                                *ngIf="hd.trang_thai === 'ƒê√£ duy·ªát' && !hd.daXuatHoaDon" 
                                class="badge-corner">!</span>
                            </div>
                        </tr>

                        <!-- D√≤ng chi ti·∫øt ngay d∆∞·ªõi -->
                        <tr *ngIf="selectedHoaDon?.receipt_code === hd.receipt_code">
                          <td colspan="6">
                            <div class="detail-container">

<!---------------------------- Chi ti·∫øt PHI·∫æU NH·∫¨P ---------------------------->
                              <ng-container *ngIf="hd.loai === 'Phi·∫øu nh·∫≠p kho'; else chiTietXuat">
                                
                              <button class="btn-close-top" (click)="dongChiTiet()">‚úñ</button>
                              <div id="hoa-don-xuat-pdf">
                              <h3>üìã M√£ ƒë∆°n nh·∫≠p kho: {{ selectedHoaDon.receipt_code }}</h3>

                              <h3>PHI·∫æU NH·∫¨P KHO - WAREHOUSE MANAGER T&H</h3>

                              <!-- üîµ Thanh tr·∫°ng th√°i ki·ªÉu ch·∫•m tr√≤n hi·ªán ƒë·∫°i -->
                              <!-- N·∫øu tr·∫°ng th√°i kh√¥ng ph·∫£i ƒê√£ h·ªßy th√¨ hi·ªÉn th·ªã timeline 3 b∆∞·ªõc b√¨nh th∆∞·ªùng -->
                              <div class="timeline-container" *ngIf="selectedHoaDon.trang_thai !== 'ƒê√£ h·ªßy'">
                                <div class="timeline">
                                  <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ g·ª≠i phi·∫øu')">
                                    <div class="circle">1</div>
                                    <span>ƒê√£ g·ª≠i phi·∫øu</span>
                                  </div>
                                  <div class="line"></div>
                                  <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ duy·ªát')">
                                    <div class="circle">2</div>
                                    <span>ƒê√£ duy·ªát</span>
                                  </div>
                                  <div class="line"></div>
                                  <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ nh·∫≠p h√†ng v√†o kho')">
                                    <div class="circle">3</div>
                                    <span>ƒê√£ nh·∫≠p h√†ng v√†o kho</span>
                                  </div>
                                </div>
                              </div>

                              <!-- N·∫øu tr·∫°ng th√°i l√† ƒê√£ h·ªßy th√¨ hi·ªÉn th·ªã 1 ch·∫•m ƒë·ªè c√≥ d·∫•u X -->
                              <div class="timeline-container" *ngIf="selectedHoaDon.trang_thai === 'ƒê√£ h·ªßy'">
                                <div class="timeline">
                                  <div class="step">
                                    <div class="circle-huy"></div>
                                    <span>ƒê√£ h·ªßy</span>
                                  </div>
                                </div>
                              </div>

                              <!-- Th·ªùi gian & NCC -->
                              <div class="info-row">
                                <div class="info-section">
                                  <h5>Th·ªùi gian</h5>
                                  <p><strong> Ng√†y t·∫°o:</strong> {{ selectedHoaDon.created_date | date:'dd/MM/yyyy' }}</p>
                                  <p><strong> Ng√†y h·∫πn:</strong> {{ selectedHoaDon.meeting_date | date:'dd/MM/yyyy' }}</p>
                                </div>
                                <div class="info-section">
                                  <h5> Nh√† cung c·∫•p</h5>
                                  <p><strong> Logo:</strong></p>
                                  <img [src]="selectedHoaDon.logo_url" height="40" *ngIf="selectedHoaDon.logo_url" />
                                  <p><strong>T√™n NCC:</strong> {{ selectedHoaDon.supplier_name }}</p>
                                  <p><strong> ƒê·ªãa ch·ªâ:</strong> {{ selectedHoaDon.supplier_address }}</p>
                                  <p><strong> Ng∆∞·ªùi ƒë·∫°i di·ªán:</strong> {{ selectedHoaDon.representative_name  }}</p>
                                  <p><strong> Email:</strong> {{ selectedHoaDon.representative_name  }}</p>
                                  <p><strong> S·ªë ƒëi·ªán tho·∫°i:</strong> {{ selectedHoaDon.representative_phone }}</p>
                                </div>
                              </div>

                              <!-- Qu·∫£n l√Ω & Ghi ch√∫ -->
                              <div class="info-row">
                                <div class="info-section">
                                  <h5> Nh√¢n vi√™n t·∫°o , duy·ªát ƒë∆°n</h5>
                                  <p><strong> Nh√¢n vi√™n t·∫°o ƒë∆°n:</strong> {{ selectedHoaDon.staff_account_name || 'Ch∆∞a c√≥' }}</p>
                                  <p><strong> Email:</strong> {{ selectedHoaDon.staff_account_email || 'Ch∆∞a c√≥' }}</p>
                                  <p><strong> Qu·∫£n l√Ω kho duy·ªát ƒë∆°n:</strong> {{ selectedHoaDon.admin_account_name || 'Ch∆∞a c√≥' }}</p>
                                  <p><strong> Email:</strong> {{ selectedHoaDon.admin_account_email || 'Ch∆∞a c√≥' }}</p>
                                </div>
                                <div class="info-section">
                                  <h5> Ghi ch√∫ & Ph·∫£n h·ªìi</h5>
                                  <p><strong> Ghi ch√∫ c·ªßa b·∫°n:</strong> {{ selectedHoaDon.note }}</p>
                                  <p><strong> Ph·∫£n h·ªìi c·ªßa qu·∫£n l√Ω:</strong> {{ selectedHoaDon.note_admin }}</p>
                                </div>
                              </div>

                              <!-- Danh s√°ch s·∫£n ph·∫©m -->
                              <h4> Danh s√°ch s·∫£n ph·∫©m</h4>
                              <table class="detail-table">
                                <thead>
                                  <tr>
                                    <th>STT</th>
                                    <th>H√¨nh ·∫£nh</th>
                                    <th>M√£ SP</th>
                                    <th>T√™n s·∫£n ph·∫©m</th>
                                    <th>Lo·∫°i</th>
                                    <th>ƒê∆°n v·ªã</th>
                                    <th>Kh·ªëi l∆∞·ª£ng</th>
                                    <th>Di·ªán t√≠ch</th>
                                    <th>NSX</th>
                                    <th>HSD</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>ƒê∆°n gi√°</th>
                                    <th>Th√†nh ti·ªÅn</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let sp of selectedHoaDon.products; let i = index">
                                    <td>{{ i + 1 }}</td>
                                    <td><img [src]="sp.image_url" height="40" /></td>
                                    <td>
                                      <svg [id]="'barcode-' + sp.product_code"></svg>
                                      <div style="font-size: 12px; margin-top: 2px;">{{ sp.product_code }}</div>
                                    </td>
                                    <td>{{ sp.product_name }}</td>
                                    <td>{{ sp.product_type }}</td>
                                    <td>{{ sp.unit }}</td>
                                    <td>{{ sp.weight }} kg</td>
                                    <td>{{ sp.area }} m¬≤</td>
                                    <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                                    <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>
                                    <td>{{ sp.quantity }}</td>
                                    <td>{{ sp.unit_price | number }}</td>
                                    <td>{{ sp.total_price | number }}</td>
                                  </tr>
                                </tbody>
                              </table>

                              <div class="total-amount">
                                <strong> T·ªïng c·ªông:</strong> {{ selectedHoaDon.total_amount | number:'1.0-0' }} VNƒê
                              </div>
                              </div>

                              <div style="text-align: right; margin-top: 12px;">
                                <div class="btn-wrapper" style="text-align: right; margin-top: 12px;">
                                  <button class="btn-export" (click)="xuatHoaDonNhapThongMinh(selectedHoaDon)">
                                    üßæ Xu·∫•t h√≥a ƒë∆°n
                                  </button>
                                  <span 
                                    *ngIf="selectedHoaDon.trang_thai === 'ƒê√£ duy·ªát' && !selectedHoaDon.daXuatHoaDon" 
                                    class="badge-corner">!</span>
                                </div>
                                &nbsp;
                                <button 
                                  class="btn-update" 
                                  [disabled]="
                                    selectedHoaDon.trang_thai === 'ƒê√£ duy·ªát' || 
                                    selectedHoaDon.trang_thai === 'ƒê√£ nh·∫≠p h√†ng v√†o kho' || 
                                    selectedHoaDon.trang_thai === 'ƒê√£ h·ªßy'
                                  "
                                  (click)="capNhatPhieuNhap(selectedHoaDon)">
                                  ‚úèÔ∏è C·∫≠p nh·∫≠t phi·∫øu nh·∫≠p
                                </button>
                              </div>
                              </ng-container>

<!---------------------------- Chi ti·∫øt PHI·∫æU XU·∫§T ---------------------------->
                              <ng-template #chiTietXuat>
                                <button class="btn-close-top" (click)="dongChiTiet()">‚úñ</button>
                                <div id="hoa-don-xuat-pdf">
                                <h3>üìã M√£ ƒë∆°n xu·∫•t kho: {{ selectedHoaDon.receipt_code }}</h3>

                                <h3>PHI·∫æU XU·∫§T KHO - WAREHOUSE MANAGER T&H</h3>

                                <!-- üîµ Thanh tr·∫°ng th√°i -->
                                <!-- N·∫øu tr·∫°ng th√°i l√† ƒê√£ h·ªßy th√¨ hi·ªÉn th·ªã 1 ch·∫•m ƒë·ªè c√≥ d·∫•u X -->
                                <div class="timeline-container" *ngIf="selectedHoaDon.trang_thai === 'ƒê√£ h·ªßy'">
                                  <div class="timeline">
                                    <div class="step">
                                      <div class="circle-huy"></div>
                                      <span>ƒê√£ h·ªßy</span>
                                    </div>
                                  </div>
                                </div>

                                <!-- N·∫øu tr·∫°ng th√°i kh√¥ng ph·∫£i ƒê√£ h·ªßy th√¨ hi·ªÉn th·ªã timeline 3 b∆∞·ªõc b√¨nh th∆∞·ªùng -->
                                <div class="timeline-container" *ngIf="selectedHoaDon.trang_thai !== 'ƒê√£ h·ªßy'">
                                  <div class="timeline">
                                    <div class="step" [ngClass]="getStepClassXuat(selectedHoaDon.trang_thai, 'ƒê√£ g·ª≠i phi·∫øu')">
                                      <div class="circle">1</div>
                                      <span>ƒê√£ g·ª≠i phi·∫øu</span>
                                    </div>
                                    <div class="line"></div>
                                    <div class="step" [ngClass]="getStepClassXuat(selectedHoaDon.trang_thai, 'ƒê√£ duy·ªát')">
                                      <div class="circle">2</div>
                                      <span>ƒê√£ duy·ªát</span>
                                    </div>
                                    <div class="line"></div>
                                    <div class="step" [ngClass]="getStepClassXuat(selectedHoaDon.trang_thai, 'ƒê√£ xu·∫•t h√†ng kh·ªèi kho')">
                                      <div class="circle">3</div>
                                      <span>ƒê√£ xu·∫•t h√†ng kh·ªèi kho</span>
                                    </div>
                                  </div>
                                </div>


                                <!-- Th·ªùi gian & NCC -->
                                <div class="info-row">
                                  <div class="info-section">
                                    <h5> Th·ªùi gian</h5>
                                    <p><strong> Ng√†y t·∫°o:</strong> {{ selectedHoaDon.created_date | date:'dd/MM/yyyy' }}</p>
                                    <p><strong> Ng√†y h·∫πn:</strong> 
                                      {{ selectedHoaDon.delivery_date ? (selectedHoaDon.delivery_date| date:'dd/MM/yyyy') : 'Ch∆∞a c√≥' }}
                                    </p>
                                  </div>
                                  <div class="info-section">
                                    <h5> Th√¥ng tin b√™n nh·∫≠n h√†ng</h5>
                                    <p><strong> Logo:</strong></p>
                                    <img [src]="selectedHoaDon.logo_url" height="40" *ngIf="selectedHoaDon.logo_url" />
                                    <p><strong> T√™n doanh nghi·ªáp/trung t√¢m th∆∞∆°ng m·∫°i, ... :</strong> <br>{{ selectedHoaDon.receiver_name }}</p>
                                    <p><strong> ƒê·ªãa ch·ªâ doanh nghi·ªáp/trung t√¢m th∆∞∆°ng m·∫°i, ... :</strong> <br> {{ selectedHoaDon.receiver_address }}</p>
                                    <p><strong> H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n:</strong> {{ selectedHoaDon.representative_name }}</p>
                                    <p><strong> Email:</strong> {{ selectedHoaDon.representative_email }}</p>
                                    <p><strong> S·ªë ƒëi·ªán tho·∫°i:</strong> {{ selectedHoaDon.representative_phone}}</p>
                                  </div>
                                </div>
                                
                                <!-- Qu·∫£n l√Ω v√† ghi ch√∫-->
                                <div class="info-row">
                                  <div class="info-section">
                                    <h5> Nh√¢n vi√™n ki·ªÉm tra , duy·ªát ƒë∆°n</h5>
                                    <p><strong> Nh√¢n vi√™n:</strong> {{ selectedHoaDon.staff_account_name || 'Ch∆∞a c√≥' }}</p>
                                    <p><strong> Email:</strong> {{ selectedHoaDon.staff_account_email || 'Ch∆∞a c√≥' }}</p>
                                    <p><strong> Qu·∫£n l√Ω kho:</strong> {{ selectedHoaDon.admin_account_name || 'Ch∆∞a c√≥' }}</p>
                                    <p><strong> Email:</strong> {{ selectedHoaDon.admin_account_email || 'Ch∆∞a c√≥' }}</p>
                                  </div>
                                  <div class="info-section">
                                    <h5> Ghi ch√∫ & Ph·∫£n h·ªìi</h5>
                                    <p><strong> Ghi ch√∫:</strong> {{ selectedHoaDon.note }}</p>
                                    <p><strong> Ph·∫£n h·ªìi t·ª´ kho:</strong> {{ selectedHoaDon.note_admin }}</p>
                                  </div>
                                </div>

                                <!-- Danh s√°ch s·∫£n ph·∫©m xu·∫•t -->
                                <h4> Danh s√°ch s·∫£n ph·∫©m</h4>
                                <table class="detail-table">
                                  <thead>
                                    <tr>
                                      <th>STT</th>
                                      <th>H√¨nh ·∫£nh</th>
                                      <th>M√£ SP</th>
                                      <th>T√™n SP</th>
                                      <th>Lo·∫°i</th>
                                      <th>ƒê∆°n v·ªã</th>
                                      <th>Kh·ªëi l∆∞·ª£ng</th>
                                      <th>NSX</th>
                                      <th>HSD</th>
                                      <th>S·ªë l∆∞·ª£ng</th>
                                      <th>ƒê∆°n gi√°</th>
                                      <th>Th√†nh ti·ªÅn</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let sp of selectedHoaDon.products; let i = index">
                                      <td>{{ i + 1 }}</td>
                                      <td><img [src]="sp.image_url" height="40" /></td>
                                      <td>
                                        <svg [id]="'barcode-' + sp.product_code"></svg>
                                        <div style="font-size: 12px; margin-top: 2px;">{{ sp.product_code }}</div>
                                      </td>
                                      <td>{{ sp.product_name }}</td>
                                      <td>{{ sp.product_type }}</td>
                                      <td>{{ sp.unit }}</td>
                                      <td>{{ sp.weight }} kg</td>
                                      <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                                      <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>
                                      <td>{{ sp.quantity }}</td>
                                      <td>{{ sp.unit_price | number:'1.0-0' }}</td>
                                      <td>{{ sp.total_price | number:'1.0-0' }}</td>
                                    </tr>
                                  </tbody>
                                </table>

                                <div class="total-weight">
                                  <strong>T·ªïng tr·ªçng l∆∞·ª£ng ƒë∆°n h√†ng:</strong> {{ selectedHoaDon.total_weight | number:'1.0-0' }} KG
                                </div>

                                <!-- T·ªïng c·ªông -->
                                <div class="total-amount">
                                  <strong>T·ªïng c·ªông:</strong> {{ selectedHoaDon.total_amount | number:'1.0-0' }} VNƒê
                                </div>
                                </div>
                                  

                                <br>


                                <div style="text-align: right; margin-top: 12px;">
                                <div class="btn-wrapper" style="text-align: right; margin-top: 12px;">
                                  <button class="btn-export" (click)="xuatHoaDonXuatThongMinh(selectedHoaDon)">
                                    üßæ Xu·∫•t h√≥a ƒë∆°n
                                  </button>
                                  <span 
                                    *ngIf="selectedHoaDon.trang_thai === 'ƒê√£ duy·ªát' && !selectedHoaDon.daXuatHoaDon" 
                                    class="badge-corner">!</span>
                                </div>
                                &nbsp;
                                <button  
                                  class="btn-update" 
                                  [disabled]="
                                    selectedHoaDon.trang_thai === 'ƒê√£ duy·ªát' || 
                                    selectedHoaDon.trang_thai === 'ƒê√£ xu·∫•t h√†ng kh·ªèi kho' || 
                                    selectedHoaDon.trang_thai === 'ƒê√£ h·ªßy'
                                  "
                                  (click)="capNhatPhieuXuat(selectedHoaDon)">
                                  ‚úèÔ∏è C·∫≠p nh·∫≠t phi·∫øu xu·∫•t
                                </button>
                              </div>


                              </ng-template>

                            </div>
                          </td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div>


                  <!-- Popup c·∫≠p nh·∫≠t -->
                  <!-- ‚úÖ POPUP C·∫¨P NH·∫¨T PHI·∫æU NH·∫¨P -->
                  <div *ngIf="capNhatMo" class="popup-capnhat">

                    <h3>‚úèÔ∏è C·∫≠p nh·∫≠t phi·∫øu nh·∫≠p: {{ phieuDangCapNhat.receipt_code }}</h3>

                    <!-- üîµ Thanh tr·∫°ng th√°i -->
                    <!-- üîµ Thanh tr·∫°ng th√°i ki·ªÉu ch·∫•m tr√≤n hi·ªán ƒë·∫°i -->
                    <div class="timeline-container">
                      <div class="timeline">
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ g·ª≠i phi·∫øu')">
                          <div class="circle">1</div>
                          <span>ƒê√£ g·ª≠i phi·∫øu</span>
                        </div>
                        <div class="line"></div>
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ duy·ªát')">
                          <div class="circle">2</div>
                          <span>ƒê√£ duy·ªát</span>
                        </div>
                        <div class="line"></div>
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ nh·∫≠p h√†ng v√†o kho')">
                          <div class="circle">3</div>
                          <span>ƒê√£ nh·∫≠p h√†ng v√†o kho</span>
                        </div>
                      </div>
                    </div>

                    <!-- Th√¥ng tin 2 c·ªôt -->
                    <!-- B·ªë c·ª•c m·ªói h√†ng 2 nh√≥m -->
                    <div class="info-row">
                      <div class="info-section">
                        <h5> Th·ªùi gian</h5>
                        <p><strong> Ng√†y t·∫°o:</strong> {{ phieuDangCapNhat.created_date | date:'dd/MM/yyyy' }}</p>
                        <p><strong> Ng√†y h·∫πn:</strong> <input type="date" [(ngModel)]="phieuDangCapNhat.meeting_date" /></p>
                      </div>

                      <div class="info-section">
                        <h5> Nh√† cung c·∫•p</h5>
                        <p><strong> Logo:</strong></p>
                        <img [src]="previewLogo || phieuDangCapNhat.logo_url" height="40" *ngIf="phieuDangCapNhat.logo_url || previewLogo" />
                        <input type="file" (change)="onLogoSelected($event)" />
                        <p><strong>T√™n NCC:</strong> <input [(ngModel)]="phieuDangCapNhat.supplier_name" /></p>
                        <p><strong> ƒê·ªãa ch·ªâ:</strong> <input [(ngModel)]="phieuDangCapNhat.supplier_address" /></p>
                        <p><strong> Ng∆∞·ªùi ƒë·∫°i di·ªán:</strong> <input [(ngModel)]="phieuDangCapNhat.representative_name " /></p>
                        <p><strong> Email:</strong> <input [(ngModel)]="phieuDangCapNhat.representative_email" /></p>
                        <p><strong> SƒêT:</strong> <input [(ngModel)]="phieuDangCapNhat.representative_phone" /></p>
                      </div>
                    </div>

                    <div class="info-row">
                      <div class="info-section">
                        <h5> Th√¥ng tin nh√¢n vi√™n t·∫°o , duy·ªát ƒë∆°n</h5>
                        <p><strong> Nh√¢n vi√™n t·∫°o ƒë∆°n:</strong> {{ phieuDangCapNhat.staff_account_name || 'Ch∆∞a c√≥' }}</p>
                        <p><strong> Email:</strong> {{ phieuDangCapNhat.staff_account_email || 'Ch∆∞a c√≥' }}</p><br>
                        <p><strong> Qu·∫£n l√Ω kho duy·ªát ƒë∆°n:</strong> {{ phieuDangCapNhat.admin_account_name || 'Ch∆∞a c√≥' }}</p>
                        <p><strong> Email:</strong> {{ phieuDangCapNhat.admin_account_email || 'Ch∆∞a c√≥' }}</p>
                      </div>

                      <div class="info-section">
                        <h5> Ghi ch√∫ & Ph·∫£n h·ªìi</h5>
                        <p><strong> Ghi ch√∫ c·ªßa b·∫°n:</strong> <textarea [(ngModel)]="phieuDangCapNhat.note"></textarea></p>
                      </div>
                    </div>


                    <!-- Danh s√°ch s·∫£n ph·∫©m -->
                    <h4> Danh s√°ch s·∫£n ph·∫©m</h4>

                    <div class="table-scroll-x">
                      <table class="detail-table">
                        <thead>
                          <tr>
                            <th>STT</th>
                            <th>H√¨nh ·∫£nh</th>
                            <th>M√£ s·∫£n ph·∫©m</th>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>Lo·∫°i</th>
                            <th>ƒê∆°n v·ªã</th>
                            <th>Kh·ªëi l∆∞·ª£ng 1 SP (kg)</th> <!-- ‚úÖ C·ªôt m·ªõi -->
                            <th>Kh·ªëi l∆∞·ª£ng l√¥ h√†ng (kg)</th>
                            <th>Di·ªán t√≠ch l√¥ h√†ng (m¬≤)</th>
                            <th>Ng√†y s·∫£n xu·∫•t</th>
                            <th>H·∫°n s·ª≠ d·ª•ng</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>ƒê∆°n gi√°</th>
                            <th>Th√†nh ti·ªÅn</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let sp of phieuDangCapNhat.products; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td>
                              <img [src]="sp.preview_image || sp.image_url" height="40" *ngIf="sp.preview_image || sp.image_url" /><br />
                              <input type="file" (change)="onProductImageSelected($event, sp)" /><br />
                            </td>
                            <td><input [(ngModel)]="sp.product_code" /></td>
                            <td><input [(ngModel)]="sp.product_name" /></td>
                            <td><input [(ngModel)]="sp.product_type" /></td>
                            <td><input [(ngModel)]="sp.unit" /></td>

                            <!-- ‚úÖ Kh·ªëi l∆∞·ª£ng 1 s·∫£n ph·∫©m -->
                            <td>
                              <input [(ngModel)]="sp.kg_per_unit" type="number"
                                    (input)="capNhatKhoiLuongVaDienTich(i)" style="width: 90px;" />
                            </td>

                            <!-- ‚úÖ Tr·ªçng l∆∞·ª£ng l√¥ h√†ng (readonly) -->
                            <td>
                              <input [(ngModel)]="sp.weight" type="number" readonly style="background-color: #f0f0f0;" />
                            </td>

                            <!-- ‚úÖ Di·ªán t√≠ch (readonly) -->
                            <td>
                              <input [(ngModel)]="sp.area" type="number" readonly style="background-color: #f0f0f0;" />
                            </td>

                            <td><input [(ngModel)]="sp.manufacture_date" type="date" /></td>
                            <td><input [(ngModel)]="sp.expiry_date" type="date" /></td>

                            <!-- ‚úÖ Khi thay ƒë·ªïi s·ªë l∆∞·ª£ng c≈©ng ph·∫£i c·∫≠p nh·∫≠t tr·ªçng l∆∞·ª£ng + di·ªán t√≠ch -->
                            <td>
                              <input [(ngModel)]="sp.quantity" type="number"
                                    (input)="capNhatKhoiLuongVaDienTich(i)" />
                            </td>

                            <td><input [(ngModel)]="sp.unit_price" type="number" /></td>
                            <td>{{ sp.quantity * sp.unit_price | number:'1.0-0' }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- T·ªïng ti·ªÅn -->
                    <!-- T·ªïng ti·ªÅn -->
                    <div class="total-amount">
                      <strong>üí∞ T·ªïng c·ªông:</strong>
                      {{ getTongTien(phieuDangCapNhat) | number:'1.0-0' }} VNƒê
                    </div>

                    <!-- N√∫t l∆∞u -->
                    <div style="text-align: right; margin-top: 20px;">
                      <button (click)="luuCapNhatPhieu()"> L∆∞u c·∫≠p nh·∫≠t</button>
                      <button (click)="dongPopupCapNhat()">‚ùå ƒê√≥ng</button>
                    </div>
                  </div>

                  <!-- ‚úÖ POPUP C·∫¨P NH·∫¨T PHI·∫æU XU·∫§T -->
                  <div *ngIf="capNhatXuatMo" class="popup-capnhat">

                    <h3>‚úèÔ∏è C·∫≠p nh·∫≠t phi·∫øu xu·∫•t: {{ phieuDangCapNhat.receipt_code }}</h3>

                    <!-- üîµ Thanh tr·∫°ng th√°i -->
                    <!-- üîµ Thanh tr·∫°ng th√°i ki·ªÉu ch·∫•m tr√≤n hi·ªán ƒë·∫°i -->
                    <div class="timeline-container">
                      <div class="timeline">
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ g·ª≠i phi·∫øu')">
                          <div class="circle">1</div>
                          <span>ƒê√£ g·ª≠i phi·∫øu</span>
                        </div>
                        <div class="line"></div>
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ duy·ªát')">
                          <div class="circle">2</div>
                          <span>ƒê√£ duy·ªát</span>
                        </div>
                        <div class="line"></div>
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ƒê√£ nh·∫≠p h√†ng v√†o kho')">
                          <div class="circle">3</div>
                          <span>ƒê√£ nh·∫≠p h√†ng v√†o kho</span>
                        </div>
                      </div>
                    </div>

                    <!-- Th√¥ng tin -->
                    <div class="info-row">
                      <div class="info-section">
                        <h5> Th·ªùi gian</h5>
                        <p><strong> Ng√†y t·∫°o:</strong> {{ phieuDangCapNhat.created_date | date:'dd/MM/yyyy' }}</p>
                        <p><strong> Ng√†y h·∫πn:</strong>  
                          <input type="date" [(ngModel)]="phieuDangCapNhat.delivery_date" />
                        </p>

                      </div>
                      <div class="info-section">
                        <h5> Ng∆∞·ªùi nh·∫≠n h√†ng</h5>
                        <p><strong> Logo:</strong></p>
                        <img [src]="previewLogo || phieuDangCapNhat.logo_url" height="40" *ngIf="phieuDangCapNhat.logo_url || previewLogo" />
                        <input type="file" (change)="onLogoSelected($event)" />
                        <p><strong> T√™n doanh nghi·ªáp / t·ªï ch·ª©c:</strong> <input [(ngModel)]="phieuDangCapNhat.receiver_name" /></p>
                        <p><strong> ƒê·ªãa ch·ªâ:</strong> <input [(ngModel)]="phieuDangCapNhat.receiver_address" /></p>
                        <p><strong> H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n:</strong> {{ phieuDangCapNhat.representative_name }}</p>
                        <p><strong> Email:</strong> <input [(ngModel)]="phieuDangCapNhat.representative_email" /></p>
                        <p><strong> SƒêT:</strong> <input [(ngModel)]="phieuDangCapNhat.representative_phone" /></p>
                      </div>
                    </div>

                    <div class="info-row">
                      <div class="info-section">
                        <h5> Th√¥ng tin nh√¢n vi√™n t·∫°o , duy·ªát ƒë∆°n</h5>
                        <p><strong> Nh√¢n vi√™n:</strong> {{ phieuDangCapNhat.staff_account_name || 'Ch∆∞a c√≥' }}</p>
                        <p><strong> Email:</strong> {{ phieuDangCapNhat.staff_account_email || 'Ch∆∞a c√≥' }}</p><br>
                        <p><strong> Qu·∫£n l√Ω:</strong> {{ phieuDangCapNhat.admin_account_name || 'Ch∆∞a c√≥' }}</p>
                        <p><strong> Email:</strong> {{ phieuDangCapNhat.admin_account_email || 'Ch∆∞a c√≥' }}</p>
                      </div>
                      <div class="info-section">
                        <h5> Ghi ch√∫ & Ph·∫£n h·ªìi</h5>
                        <p><strong> Ghi ch√∫:</strong> <textarea [(ngModel)]="phieuDangCapNhat.note"></textarea></p>
                      </div>
                    </div>

                    <!-- Danh s√°ch s·∫£n ph·∫©m -->
                    <h4> Danh s√°ch s·∫£n ph·∫©m</h4>
                    <div class="table-scroll-x">
                      <table class="detail-table">
                        <thead>
                          <tr>
                            <th>STT</th>
                            <th>H√¨nh ·∫£nh</th>
                            <th>M√£ SP</th>
                            <th>T√™n SP</th>
                            <th>Lo·∫°i</th>
                            <th>ƒê∆°n v·ªã</th>
                            <th>Kh·ªëi l∆∞·ª£ng (kg)</th>
                            <th>NSX</th>
                            <th>HSD</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>ƒê∆°n gi√°</th>
                            <th>Th√†nh ti·ªÅn</th>
                          </tr>
                        </thead>
                        <tbody> 
                          <tr *ngFor="let sp of phieuDangCapNhat.products; let i = index">
                            <td>{{ i + 1 }}</td>

                            <!-- H√¨nh ·∫£nh (hi·ªÉn th·ªã ·∫£nh, kh√¥ng cho upload) -->
                            <td>
                              <img [src]="sp.image_url" height="40" *ngIf="sp.image_url" />
                            </td>

                            <!-- Ch·ªâ hi·ªÉn th·ªã th√¥ng tin (kh√¥ng c√≤n l√† input) -->
                            <td>{{ sp.product_code }}</td>
                            <td>{{ sp.product_name }}</td>
                            <td>{{ sp.product_type }}</td>
                            <td>{{ sp.unit }}</td>
                            <td>{{ sp.weight }} kg</td>

                            <!-- NSX & HSD ch·ªâ hi·ªÉn th·ªã -->
                            <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                            <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>

                            <!-- ‚úÖ S·ªë l∆∞·ª£ng ƒë∆∞·ª£c ph√©p ch·ªânh -->
                            <td><input [(ngModel)]="sp.quantity" type="number" /></td>

                            <!-- Gi√° v√† th√†nh ti·ªÅn ch·ªâ hi·ªÉn th·ªã -->
                            <td>{{ sp.unit_price | number:'1.0-0' }}</td>
                            <td>{{ sp.quantity * sp.unit_price | number:'1.0-0' }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- T·ªïng c·ªông -->
                    <div class="total-amount">
                      <strong> T·ªïng c·ªông:</strong> {{ getTongTien(phieuDangCapNhat) | number:'1.0-0' }} VNƒê
                    </div>

                    <!-- N√∫t l∆∞u -->
                    <div style="text-align: right; margin-top: 20px;">
                      <button (click)="luuCapNhatPhieu()"> L∆∞u c·∫≠p nh·∫≠t</button>
                      <button (click)="dongPopupCapNhat()">‚ùå ƒê√≥ng</button>
                    </div>

                  </div>


                  <br>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
