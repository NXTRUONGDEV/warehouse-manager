<div class="main-panel">
  <h2>ğŸ“¥ Danh sÃ¡ch phiáº¿u nháº­p kho</h2>

  <table class="invoice-table">
    <thead>
      <tr>
        <th>MÃ£ phiáº¿u</th>
        <th>NhÃ  cung cáº¥p</th>
        <th>NgÃ y táº¡o</th>
        <th>Tráº¡ng thÃ¡i</th>
        <th>Xem</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let p of danhSachPhieu">
        <!-- DÃ²ng chÃ­nh -->
        <tr>
          <td>{{ p.receipt_code }}</td>
          <td>{{ p.supplier_name }}</td>
          <td>{{ p.created_date | date:'dd/MM/yyyy' }}</td>
          <td><span>{{ p.trang_thai }}</span></td>
          <td>
            <button *ngIf="p.trang_thai === 'ÄÃ£ Ä‘Äƒng kÃ½'" (click)="xemChiTiet(p)">ğŸ” Táº¡o Ä‘Æ¡n</button>
            <button *ngIf="p.trang_thai === 'ÄÃ£ táº¡o phiáº¿u - Ä‘á»£i duyá»‡t'" (click)="xemChiTiet(p)">ğŸ”„ Cáº­p nháº­t</button>
            <button *ngIf="p.trang_thai === 'ÄÃ£ duyá»‡t - háº¹n gáº·p' || p.trang_thai === 'HoÃ n táº¥t nháº­p hÃ ng'" class="disabled-button" disabled>
              ğŸ”„ Cáº­p nháº­t
            </button>
          </td>
        </tr>

        <!-- Chi tiáº¿t phiáº¿u hiá»ƒn thá»‹ ngay bÃªn dÆ°á»›i -->
        <tr *ngIf="selectedPhieu?.id === p.id">
          <td colspan="5">
            <div class="detail-container">
              <button class="btn-close-top" (click)="dongChiTiet()">âœ–</button>
              <h3>ğŸ“‹ Chi tiáº¿t phiáº¿u: {{ selectedPhieu.receipt_code }}</h3>

              <div class="detail-info-wrapper-2col">
                <div class="info-section">
                  <h3>â± ThÃ´ng tin thá»i gian</h3>
                  <p><strong>ğŸ“… NgÃ y táº¡o:</strong> {{ selectedPhieu.created_date | date:'MM/dd/yyyy' }}</p>
                  <p><strong>ğŸ—“ï¸ NgÃ y háº¹n:</strong> {{ selectedPhieu.meeting_date | date:'MM/dd/yyyy' }}</p>
                </div>

                <div class="info-section">
                  <h3>ğŸ¢ NhÃ  cung cáº¥p</h3>
                  <p class="supplier-logo">
                    <strong>ğŸï¸ Logo:</strong>
                    <img [src]="selectedPhieu.logo_url" alt="Logo nhÃ  cung cáº¥p" height="40" />
                  </p>
                  <p><strong>ğŸ¢ TÃªn NCC:</strong> {{ selectedPhieu.supplier_name }}</p>
                  <p><strong>ğŸ“ Äá»‹a chá»‰:</strong> {{ selectedPhieu.supplier_address }}</p>
                  <p><strong>ğŸ‘¤ Äáº¡i diá»‡n:</strong> {{ selectedPhieu.full_name }}</p>
                  <p><strong>ğŸ“§ Email:</strong> {{ selectedPhieu.supplier_account_email }}</p>
                  <p><strong>ğŸ“ SÄT:</strong> {{ selectedPhieu.phone }}</p>
                </div>

                <div class="info-section">
                  <h3>ğŸ“ Ghi chÃº & Pháº£n há»“i</h3>
                  <p><strong>ğŸ“ Ghi chÃº:</strong> {{ selectedPhieu.note || 'KhÃ´ng cÃ³' }}</p>
                  <p><strong>ğŸ’¬ Pháº£n há»“i quáº£n lÃ½:</strong> {{ selectedPhieu.note_admin || 'KhÃ´ng cÃ³' }}</p>
                </div>
              </div>

              <!-- Danh sÃ¡ch sáº£n pháº©m -->
              <h4>ğŸ“¦ Danh sÃ¡ch sáº£n pháº©m</h4>
              <div class="product-table-wrapper">
                <table class="detail-table">
                  <thead>
                    <tr>
                      <th>STT</th>
                      <th>HÃ¬nh áº£nh</th>
                      <th>TÃªn sáº£n pháº©m</th>
                      <th>Loáº¡i</th>
                      <th>MÃ£ SP</th>
                      <th>ÄÆ¡n vá»‹</th>
                      <th>Khá»‘i lÆ°á»£ng</th>
                      <th>Diá»‡n tÃ­ch</th>
                      <th>NgÃ y SX</th>
                      <th>Háº¡n SD</th>
                      <th>Sá»‘ lÆ°á»£ng</th>
                      <th>ÄÆ¡n giÃ¡</th>
                      <th>ThÃ nh tiá»n</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let sp of selectedPhieu.products; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td><img [src]="sp.image_url" height="40" /></td>
                      <td>{{ sp.product_name }}</td>
                      <td>{{ sp.product_type }}</td>
                      <td>{{ sp.product_code }}</td>
                      <td>{{ sp.unit }}</td>
                      <td>{{ sp.weight }} kg</td>
                      <td>{{ sp.area }} mÂ²</td>
                      <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                      <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>
                      <td>{{ sp.quantity }}</td>
                      <td>{{ sp.unit_price | number:'1.0-0' }}</td>
                      <td>{{ sp.total_price | number:'1.0-0' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="total-amount">
                <strong>ğŸ’° Tá»•ng cá»™ng:</strong>
                {{ selectedPhieu.total_amount | number:'1.0-0' }} VNÄ
              </div>

              <br />

              <p>
                <strong>ğŸ‘¨â€ğŸ’¼ Quáº£n lÃ½ duyá»‡t:</strong>
                {{ selectedPhieu.admin_account_name || 'ChÆ°a cÃ³' }} â€” <em>email:</em>
                {{ selectedPhieu.admin_account_email || 'ChÆ°a cÃ³' }}
              </p>

              <p>
                <strong>ğŸ‘¨â€ğŸ’¼ NhÃ¢n viÃªn xá»­ lÃ½:</strong>
                {{ selectedPhieu.staff_account_name || 'ChÆ°a cÃ³' }} â€” <em>email:</em>
                {{ selectedPhieu.staff_account_email || 'ChÆ°a cÃ³' }}
              </p>

              <p>
                <strong>ğŸ‘¨â€ğŸ’¼ NhÃ¢n viÃªn hiá»‡n táº¡i:</strong>
                {{ staffName }} â€” <em>email:</em> {{ staffEmail }}
              </p>

              <p><strong>ğŸ’¬ Ghi chÃº kiá»ƒm tra:</strong></p>
              <textarea [(ngModel)]="phanHoiStaff" placeholder="Nháº­p pháº£n há»“i cá»§a báº¡n..."></textarea>

              <div class="button-group">
                <button (click)="hoanTatKiemTra()">âœ… HoÃ n táº¥t kiá»ƒm tra , táº¡o Ä‘Æ¡n</button>
              </div>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>
