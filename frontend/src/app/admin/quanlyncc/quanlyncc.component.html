<div class="ncc-container">
  <h2>Tra cá»©u nhÃ  cung cáº¥p theo mÃ£ / tÃªn sáº£n pháº©m</h2>

  <div class="search-filter-row">
    <select [(ngModel)]="selectedAreaId" (change)="locTheoKhuVuc()">
      <option value="">-- Táº¥t cáº£ khu vá»±c --</option>
      <option *ngFor="let kv of danhSachKhuVuc" [value]="kv.id">{{ kv.ten_khu_vuc }}</option>
    </select>

    <input [(ngModel)]="tuKhoa" placeholder="Nháº­p mÃ£ hoáº·c tÃªn sáº£n pháº©m..." />
    <button (click)="timNhaCungCap()">Tra cá»©u</button>
  </div>

  <!-- â³ Loading -->
  <div *ngIf="loading" class="loading">â³ Äang tÃ¬m kiáº¿m...</div>

  <!-- âŒ KhÃ´ng tÃ¬m tháº¥y mÃ£ -->
  <div *ngIf="traTheoSanPham && isMaSanPham(tuKhoa) && !loading && !nhaCungCap" class="not-found">
    âŒ KhÃ´ng tÃ¬m tháº¥y nhÃ  cung cáº¥p cho tá»« khÃ³a "{{ tuKhoa }}"
  </div>

  <!-- âŒ KhÃ´ng tÃ¬m tháº¥y tÃªn -->
  <div *ngIf="!loading && !isMaSanPham(tuKhoa) && traTheoSanPham && tuKhoa && logosTrongKhuVuc.length === 0" class="not-found">
    âŒ KhÃ´ng tÃ¬m tháº¥y nhÃ  cung cáº¥p phÃ¹ há»£p trong khu vá»±c!
  </div>

  <!-- âŒ Khu vá»±c khÃ´ng cÃ³ NCC -->
  <div *ngIf="!loading && !traTheoSanPham && selectedAreaId && logosTrongKhuVuc.length === 0" class="not-found">
    âŒ ChÆ°a cÃ³ nhÃ  cung cáº¥p nÃ o trong khu vá»±c Ä‘Æ°á»£c chá»n!
  </div>

  <!-- âœ… Káº¿t quáº£ tra cá»©u NCC -->
  <div *ngIf="nhaCungCap && traTheoSanPham" class="ncc-info-card animate-slide">
    <div class="ncc-logo-wrapper">
      <img *ngIf="nhaCungCap.logo_url" [src]="nhaCungCap.logo_url" class="ncc-logo" />
    </div>

    <h3 class="ncc-name">{{ nhaCungCap.supplier_name }}</h3>

    <div class="ncc-details">
      <p><span class="icon" style="color: black"><strong>TÃªn ngÆ°á»i Ä‘áº¡i diá»‡n:</strong> </span> {{ nhaCungCap.representative_name }}</p>
      <p><span class="icon" style="color: black"><strong>Email: </strong> </span> {{ nhaCungCap.representative_email }}</p>
      <p><span class="icon" style="color: black"><strong>Sá»‘ Ä‘iá»‡n thoáº¡i: </strong> </span> {{ nhaCungCap.representative_phone }}</p>
    </div>
  </div>



  <!-- âœ… Danh sÃ¡ch logo -->
  <div *ngIf="logosTrongKhuVuc.length > 0">
    <h3>Danh sÃ¡ch nhÃ  cung cáº¥p trong khu vá»±c</h3>
    <div class="logo-grid">
      <div
        *ngFor="let logo of logosTrongKhuVuc"
        class="logo-card animate-fade"
        (click)="chonNhaCungCap(logo)"
      >
        <img [src]="logo.logo_url" [alt]="logo.supplier_name" />
        <p>{{ logo.supplier_name }}</p>
      </div>
    </div>

    <!-- âœ… Chi tiáº¿t nhÃ  cung cáº¥p nÃ¢ng cao -->
    <div *ngIf="nhaCungCapChiTiet && !traTheoSanPham" class="ncc-info animate-slide">
      <h3 class="ncc-title">{{ nhaCungCapChiTiet.supplier_name }}</h3>

      <!-- ğŸ”„ Carousel hiá»‡n Ä‘áº¡i vuá»‘t Ä‘Æ°á»£c -->
      <div
        class="carousel-container"
        (touchstart)="touchStart($event)"
        (touchend)="touchEnd($event)"
      >
       <button class="nav-btn left" [class.disabled]="logoIndex <= 0" [disabled]="logoIndex <= 0" (click)="logoIndex = logoIndex - 1">â®</button>


        <div class="carousel-content">
          <img
            *ngIf="lichSuNhap[logoIndex]?.logo_url"
            [src]="lichSuNhap[logoIndex].logo_url"
            class="carousel-image"
          />
        </div>

        <button class="nav-btn right" [class.disabled]="logoIndex >= lichSuNhap.length - 1" [disabled]="logoIndex >= lichSuNhap.length - 1" (click)="logoIndex = logoIndex + 1">â¯</button>

      </div>

      <div class="ncc-section">
        <h4>ThÃ´ng tin nhÃ  cung cáº¥p</h4>
        <ul>
          <li *ngFor="let daiDien of lichSuNhap[logoIndex]?.dai_dien">
            ğŸ‘¤ {{ daiDien.name }} | ğŸ“§ {{ daiDien.email }} | ğŸ“ {{ daiDien.phone }}
          </li>
        </ul>
      </div>

      <div class="ncc-section">
        <h4>Sáº£n pháº©m (theo ngÃ y nháº­p):</h4>

        <div class="product-grid">
          <div class="product-card" *ngFor="let sp of lichSuNhap[logoIndex]?.san_pham">
            <img [src]="sp.image_url || 'https://via.placeholder.com/80x80?text=No+Image'" alt="áº¢nh sáº£n pháº©m" />
            <div class="info">
              <div class="code">ID: {{ sp.code }}</div>
              <div class="name">{{ sp.name }}</div>
              <div class="date">ğŸ•’ {{ sp.import_date | date: 'dd/MM/yyyy' }}</div>
            </div>
          </div>
        </div>
      </div>


    </div>



  </div>
</div>
