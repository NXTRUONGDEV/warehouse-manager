
<div class="main-panel">
    <h2>ğŸ“¥ Duyá»‡t phiáº¿u xuáº¥t kho </h2>

    <!-- Thanh lá»c phiáº¿u xuáº¥t -->
    <div class="filter-bar-phieu">
    <input type="text" [(ngModel)]="filter.keyword" placeholder="ğŸ” TÃ¬m mÃ£ phiáº¿u hoáº·c tÃªn ngÆ°á»i nháº­n..." (input)="locPhieu()" />

    <label>ğŸ“… Tá»« ngÃ y:
        <input type="date" [(ngModel)]="filter.ngayBatDau" (change)="locPhieu()" />
    </label>

    <label>ğŸ“… Äáº¿n ngÃ y:
        <input type="date" [(ngModel)]="filter.ngayKetThuc" (change)="locPhieu()" />
    </label>

    <label>ğŸ“¦ Tráº¡ng thÃ¡i:
        <select [(ngModel)]="filter.trangThai" (change)="locPhieu()">
        <option value="">Táº¥t cáº£</option>
        <option value="ÄÃ£ gá»­i phiáº¿u">ÄÃ£ gá»­i phiáº¿u</option>
        <option value="ÄÃ£ duyá»‡t">ÄÃ£ duyá»‡t</option>
        <option value="ÄÃ£ xuáº¥t hÃ ng khá»i kho">ÄÃ£ xuáº¥t hÃ ng khá»i kho</option>
        </select>
    </label>
    </div>

    <table class="invoice-table">
        <thead>
        <tr>
            <th>MÃ£ phiáº¿u</th>
            <th>TÃªn nhÃ¢n viÃªn</th>
            <th>Ghi chÃº</th>
            <th>NgÃ y Xuáº¥t</th>
            <th>Sá»‘ lÆ°á»£ng</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>Chá»©c nÄƒng</th>
            <th>Chá»n</th>
        </tr>
        </thead>
        <ng-container *ngFor="let p of danhSachPhieu">
            <!-- DÃ²ng phiáº¿u -->
            <tr>
            <td>{{ p.receipt_code }}</td>
            <td>{{ p.staff_account_name }}</td>
            <td>{{ p.note }}</td>
            <td>{{ p.created_date | date:'dd/MM/yyyy' }}</td>
            <td>{{ p.quantity }}</td>
            <td><span>{{ p.trang_thai }}</span></td>
            <td>
                <button class="btn-action"
                        (click)="xacNhanNhapKhoChinhThuc(p)"
                        [disabled]="p.trang_thai === 'ÄÃ£ xuáº¥t hÃ ng khá»i kho'"
                        [ngStyle]="{ opacity: p.trang_thai === 'ÄÃ£ xuáº¥t hÃ ng khá»i kho' ? '0.6' : '1' }"
                    > âœ… XÃ¡c nháº­n xuáº¥t hÃ ng
                </button>
                <button (click)="xemChiTiet(p)" [disabled]="selectedPhieu?.id === p.id" class="btn-action">ğŸ“‹ Chi tiáº¿t</button>
                <button (click)=" xoaPhieuXuat(p.id)"
                aria-errormessage="XoÃ¡ phiáº¿u xuáº¥t kho"
                >ğŸ—‘ï¸ XoÃ¡</button>
            </td>
            <td>
                <input type="checkbox">
            </td>

            </tr>

            <!-- DÃ²ng chi tiáº¿t náº±m ngay bÃªn dÆ°á»›i -->
            <tr *ngIf="selectedPhieu?.id === p.id">
            <td colspan="7">
                <!-- Ná»™i dung chi tiáº¿t phiáº¿u á»Ÿ Ä‘Ã¢y -->
                <!-- Chi tiáº¿t phiáº¿u -->
                <div class="detail-container">
                    <button class="btn-close-top" (click)="dongChiTiet()">âœ–</button>
                    <h3>ğŸ“‹ Chi tiáº¿t phiáº¿u: {{ selectedPhieu.receipt_code }}</h3>
                    <!-- ThÃ´ng tin chung -->
                    <div class="detail-info-wrapper">
                    <!-- HÃ ng Ä‘áº§u tiÃªn: ThÃ´ng tin thá»i gian -->
                    <div class="info-row full-width">
                        <div class="info-section">
                        <h3>â± ThÃ´ng tin thá»i gian</h3>
                        <p><strong>ğŸ“… NgÃ y táº¡o:</strong> {{ selectedPhieu.created_date | date:'MM/dd/yyyy' }}</p>
                        <p><strong>ğŸ—“ï¸ NgÃ y háº¹n nháº­p hÃ ng:</strong> {{ selectedPhieu.delivery_date | date:'MM/dd/yyyy' }}</p>
                        </div>
                    </div>

                    <!-- HÃ ng thá»© hai: 2 cá»™t ngang hÃ ng -->
                    <div class="info-row two-columns">
                        <!-- NhÃ  cung cáº¥p -->
                        <div class="info-section">
                        <h3>ğŸ¢ ThÃ´ng tin bÃªn nháº­n hÃ ng</h3>
                        <p class="supplier-logo">
                        <strong>ğŸï¸ Logo nhÃ  cung cáº¥p:</strong>
                        <ng-container *ngIf="selectedPhieu.logo_url; else noLogo">
                            <img [src]="selectedPhieu.logo_url" alt="Logo nhÃ  cung cáº¥p" style="height: 50px;" />
                        </ng-container>
                        <ng-template #noLogo> KhÃ´ng cÃ³</ng-template>
                        </p>
                        <p><strong>ğŸ¢ TÃªn doanh nghiá»‡p / tá»• chá»©c:</strong> {{ selectedPhieu.receiver_name }}</p>
                        <p><strong>ğŸ“ Äá»‹a chá»‰ giao hÃ ng:</strong> {{ selectedPhieu.receiver_address }}</p>
                        <p><strong>ğŸ‘¤ Há» tÃªn ngÆ°á»i nháº­n:</strong> {{ selectedPhieu.representative_name }}</p>
                        <p><strong>ğŸ“§ Email:</strong> {{ selectedPhieu.representative_email }}</p>
                        <p><strong>ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</strong> {{ selectedPhieu.representative_phone }}</p>
                        </div>

                        <!-- Ghi chÃº -->
                        <div class="info-section">
                        <h3>ğŸ“ Ghi chÃº & Pháº£n há»“i</h3>
                        <p>
                        <strong>ğŸ‘¨â€ğŸ’¼ NhÃ¢n viÃªn táº¡o phiáº¿u nÃ y:</strong><br>
                        {{ selectedPhieu.staff_account_name || 'ChÆ°a cÃ³' }} â€” <em>email:</em> {{ selectedPhieu.staff_account_email || 'ChÆ°a cÃ³' }}
                        </p>
                        <p><strong>ğŸ“ Ghi chÃº tá»« nhÃ¢n viÃªn:</strong> {{ selectedPhieu.note || 'KhÃ´ng cÃ³' }}</p>

                        <br>

                        <!-- Quáº£n lÃ½ Ä‘ang duyá»‡t hiá»‡n táº¡i -->
                        <p>
                        <strong>ğŸ‘¨â€ğŸ’¼ Quáº£n lÃ½ duyá»‡t:</strong><br>
                         {{ adminName }} â€” <em>email:</em> {{ adminEmail }}
                        </p>
                        <p><strong>ğŸ“ Pháº£n há»“i cá»§a quáº£n lÃ½ kho: </strong> {{ selectedPhieu.note_admin || 'ChÆ°a cÃ³' }}</p>
                        </div>
                    </div>
                    </div>


                    <!-- Danh sÃ¡ch sáº£n pháº©m -->
                    <h4>ğŸ“¦ Danh sÃ¡ch sáº£n pháº©m</h4>

                    <div class="product-table-wrapper">
                    <div class="scroll-x">
                    <table class="detail-table">
                        <thead>
                        <tr>
                            <th>STT</th>
                            <th>HÃ¬nh áº£nh</th>
                            <th>MÃ£ sáº£n pháº©m</th>
                            <th>TÃªn sáº£n pháº©m</th>
                            <th>Loáº¡i</th>
                            <th>ÄÆ¡n vá»‹</th>
                            <th>Trá»ng lÆ°á»£ng 1 sáº£n pháº©m (KG)</th>
                            <th>Trá»ng lÆ°á»£ng lÃ´ hÃ ng (KG)</th>
                            <th>NgÃ y sáº£n xuáº¥t</th>
                            <th>Háº¡n sá»­ dá»¥ng</th>
                            <th>Sá»‘ lÆ°á»£ng</th>
                            <th>ÄÆ¡n giÃ¡</th>
                            <th>ThÃ nh tiá»n</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let sp of selectedPhieu.products; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td><img [src]="sp.image_url" height="40" /></td>
                            <td>{{ sp.product_code }}</td>
                            <td>{{ sp.product_name }}</td>
                            <td>{{ sp.product_type }}</td>
                            
                            <td>{{ sp.unit }}</td>
                            <td>{{ sp.weight_per_unit }} kg</td>
                            <td>{{ sp.weight }} kg</td>
                            
                            <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                            <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>
                            <td>{{ sp.quantity }}</td>
                            <td>{{ sp.unit_price | number:'1.0-0' }}</td>
                            <td>{{ sp.total_price | number:'1.0-0' }}</td>
                        </tr>
                        </tbody>
                    </table>
                    </div>
                    </div>

                    <!-- Tá»•ng tiá»n -->
                    <div class="total-amount">
                    <strong>ğŸ’° Tá»•ng cá»™ng:</strong>
                    {{ selectedPhieu.total_amount | number:'1.0-0' }} VNÄ 
                    </div>

                    <br>

                    <p><strong>ğŸ’¬ Gá»­i pháº£n há»“i cho nhÃ¢n viÃªn:</strong></p>
                    <textarea [(ngModel)]="phanHoiHeThong" placeholder="Nháº­p pháº£n há»“i cho nhÃ¢n viÃªn.."></textarea>


                    <!-- NÃºt thá»±c hiá»‡n -->
                    <div class="button-group">
                    <button (click)="hoanTatKiemTra()">
                    {{ selectedPhieu?.trang_thai === 'ÄÃ£ duyá»‡t' ? 'ğŸ“© Cáº­p nháº­t pháº£n há»“i' : 'âœ… Duyá»‡t phiáº¿u , hoÃ n táº¥t kiá»ƒm tra' }}
                    </button>
                    <button (click)=" xoaPhieuXuat(p.id)">ğŸ—‘ï¸ XoÃ¡</button>

                    </div>
                </div>
            </td>
            </tr>
        </ng-container>
    </table>
</div>
