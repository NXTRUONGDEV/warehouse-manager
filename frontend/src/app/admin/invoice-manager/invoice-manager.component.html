 <div class="main-panel">

  <h2>ğŸ“‘ HÃ³a Ä‘Æ¡n tá»•ng há»£p</h2>

    <div class="invoice-container">
      <div class="filter-section">
        <!-- HÃ ng trÃªn: 3 bá»™ lá»c chÃ­nh -->
        <div class="filter-row">
          <label>ğŸ” MÃ£ phiáº¿u:
            <input [(ngModel)]="filter.keyword" (input)="locHoaDon()" />
          </label>
          <label>ğŸ“‚ Loáº¡i phiáº¿u:
            <select [(ngModel)]="filter.loai" (change)="locHoaDon()">
              <option value="">Táº¥t cáº£</option>
              <option value="Phiáº¿u nháº­p kho">Phiáº¿u nháº­p kho</option>
              <option value="Phiáº¿u xuáº¥t kho">Phiáº¿u xuáº¥t kho</option>
            </select>
          </label>
          <label>ğŸ“¦ Tráº¡ng thÃ¡i:
            <select [(ngModel)]="filter.trangThai" (change)="locHoaDon()">
              <option value="">Táº¥t cáº£</option>
              <option value="ÄÃ£ gá»­i phiáº¿u">ÄÃ£ gá»­i phiáº¿u</option>
              <option value="ÄÃ£ duyá»‡t">ÄÃ£ duyá»‡t</option>
              <option value="ÄÃ£ nháº­p hÃ ng vÃ o kho">ÄÃ£ nháº­p hÃ ng vÃ o kho</option>
              <option value="ÄÃ£ xuáº¥t hÃ ng khá»i kho">ÄÃ£ xuáº¥t hÃ ng khá»i kho</option>
            </select>
          </label>
        </div>

        <!-- HÃ ng dÆ°á»›i: NgÃ y táº¡o + Tá»•ng tiá»n -->
        <div class="filter-row">
          <label>ğŸ“… NgÃ y táº¡o tá»«:
            <input type="date" [(ngModel)]="filter.ngayBatDau" (change)="locHoaDon()" />
          </label>
          <label>Ä‘áº¿n:
            <input type="date" [(ngModel)]="filter.ngayKetThuc" (change)="locHoaDon()" />
          </label>
          <label>ğŸ’° Tá»•ng tiá»n min:
            <input type="number" [(ngModel)]="filter.tongTienMin" (input)="locHoaDon()" />
          </label>
          <label>max:
            <input type="number" [(ngModel)]="filter.tongTienMax" (input)="locHoaDon()" />
          </label>
        </div>
      </div>

      <br>

      
      <table class="invoice-table">
        <thead>
          <tr>
            <th>Loáº¡i phiáº¿u</th>
            <th>MÃ£ phiáº¿u</th>
            <th>NgÃ y táº¡o</th>
            <th>Tá»•ng tiá»n</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>Chi tiáº¿t</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let hd of filteredHoaDonList">
            <!-- DÃ²ng hÃ³a Ä‘Æ¡n -->
            <tr [ngClass]="{
              'trang-thai-duyet': hd.trang_thai === 'ÄÃ£ duyá»‡t',
              'trang-thai-nhap-kho': hd.trang_thai === 'ÄÃ£ nháº­p hÃ ng vÃ o kho' || hd.trang_thai === 'ÄÃ£ xuáº¥t hÃ ng khá»i kho'
            }">
              <td>{{ hd.loai }}</td>
              <td>{{ hd.receipt_code }}</td>
              <td>{{ hd.created_date | date:'dd/MM/yyyy' }}</td>
              <td>{{ hd.total_amount | number:'1.0-0' }} VNÄ</td>
              <td>{{ hd.trang_thai }}</td>
              <div class="btn-wrapper">
                  <button class="btn-view" (click)="xemChiTietHoaDon(hd)">
                    ğŸ” Xem
                  </button>
                  <span 
                    *ngIf="hd.trang_thai === 'ÄÃ£ duyá»‡t' && !hd.daXuatHoaDon" 
                    class="badge-corner">!</span>
                </div>
            </tr>

            <!-- DÃ²ng chi tiáº¿t ngay dÆ°á»›i -->
            <tr *ngIf="selectedHoaDon?.receipt_code === hd.receipt_code">
              <td colspan="6">
                <div class="detail-container">

<!---------------------------- Chi tiáº¿t PHIáº¾U NHáº¬P ---------------------------->
                  <ng-container *ngIf="hd.loai === 'Phiáº¿u nháº­p kho'; else chiTietXuat">
                    
                  <button class="btn-close-top" (click)="dongChiTiet()">âœ–</button>
                  <div id="hoa-don-xuat-pdf">
                  <h3>ğŸ“‹ MÃ£ Ä‘Æ¡n nháº­p kho: {{ selectedHoaDon.receipt_code }}</h3>

                  <h3>PHIáº¾U NHáº¬P KHO - WAREHOUSE MANAGER T&H</h3>

                  <!-- ğŸ”µ Thanh tráº¡ng thÃ¡i kiá»ƒu cháº¥m trÃ²n hiá»‡n Ä‘áº¡i -->
                  <div class="timeline-container">
                    <div class="timeline">
                      <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ÄÃ£ gá»­i phiáº¿u')">
                        <div class="circle">1</div>
                        <span>ÄÃ£ gá»­i phiáº¿u</span>
                      </div>
                      <div class="line"></div>
                      <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ÄÃ£ duyá»‡t')">
                        <div class="circle">2</div>
                        <span>ÄÃ£ duyá»‡t</span>
                      </div>
                      <div class="line"></div>
                      <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ÄÃ£ nháº­p hÃ ng vÃ o kho')">
                        <div class="circle">3</div>
                        <span>ÄÃ£ nháº­p hÃ ng vÃ o kho</span>
                      </div>
                    </div>
                  </div>  

                  <!-- Thá»i gian & NCC -->
                  <div class="info-row">
                    <div class="info-section">
                      <h5>â± Thá»i gian</h5>
                      <p><strong>ğŸ“… NgÃ y táº¡o:</strong> {{ selectedHoaDon.created_date | date:'dd/MM/yyyy' }}</p>
                      <p><strong>ğŸ—“ï¸ NgÃ y háº¹n:</strong> {{ selectedHoaDon.meeting_date | date:'dd/MM/yyyy' }}</p>
                    </div>
                    <div class="info-section">
                      <h5>ğŸ¢ NhÃ  cung cáº¥p</h5>
                      <p><strong>ğŸï¸ Logo:</strong></p>
                      <img [src]="selectedHoaDon.logo_url" height="40" *ngIf="selectedHoaDon.logo_url" />
                      <p><strong>TÃªn NCC:</strong> {{ selectedHoaDon.supplier_name }}</p>
                      <p><strong>ğŸ“ Äá»‹a chá»‰:</strong> {{ selectedHoaDon.supplier_address }}</p>
                      <p><strong>ğŸ‘¤ NgÆ°á»i Ä‘áº¡i diá»‡n:</strong> {{ selectedHoaDon.representative_name  }}</p>
                      <p><strong>ğŸ“§ Email:</strong> {{ selectedHoaDon.representative_name  }}</p>
                      <p><strong>ğŸ“§ Sá»‘ Ä‘iá»‡n thoáº¡i:</strong> {{ selectedHoaDon.representative_phone }}</p>
                    </div>
                  </div>

                  <!-- Quáº£n lÃ½ & Ghi chÃº -->
                  <div class="info-row">
                    <div class="info-section">
                      <h5>ğŸ‘¨â€ğŸ’¼ NhÃ¢n viÃªn táº¡o , duyá»‡t Ä‘Æ¡n</h5>
                      <p><strong>ğŸ‘¨ NhÃ¢n viÃªn táº¡o Ä‘Æ¡n:</strong> {{ selectedHoaDon.staff_account_name || 'ChÆ°a cÃ³' }}</p>
                      <p><strong>ğŸ“§ Email:</strong> {{ selectedHoaDon.staff_account_email || 'ChÆ°a cÃ³' }}</p>
                      <p><strong>ğŸ‘¨ Quáº£n lÃ½ kho duyá»‡t Ä‘Æ¡n:</strong> {{ selectedHoaDon.admin_account_name || 'ChÆ°a cÃ³' }}</p>
                      <p><strong>ğŸ“§ Email:</strong> {{ selectedHoaDon.admin_account_email || 'ChÆ°a cÃ³' }}</p>
                    </div>
                    <div class="info-section">
                      <h5>ğŸ“ Ghi chÃº & Pháº£n há»“i</h5>
                      <p><strong>ğŸ“ Ghi chÃº cá»§a báº¡n:</strong> {{ selectedHoaDon.note }}</p>
                      <p><strong>ğŸ’¬ Pháº£n há»“i cá»§a quáº£n lÃ½:</strong> {{ selectedHoaDon.note_admin }}</p>
                    </div>
                  </div>

                  <!-- Danh sÃ¡ch sáº£n pháº©m -->
                  <h4>ğŸ“¦ Danh sÃ¡ch sáº£n pháº©m</h4>
                  <table class="detail-table">
                    <thead>
                      <tr>
                        <th>STT</th>
                        <th>HÃ¬nh áº£nh</th>
                        <th>MÃ£ SP</th>
                        <th>TÃªn sáº£n pháº©m</th>
                        <th>Loáº¡i</th>
                        <th>ÄÆ¡n vá»‹</th>
                        <th>Khá»‘i lÆ°á»£ng</th>
                        <th>Diá»‡n tÃ­ch</th>
                        <th>NSX</th>
                        <th>HSD</th>
                        <th>Sá»‘ lÆ°á»£ng</th>
                        <th>ÄÆ¡n giÃ¡</th>
                        <th>ThÃ nh tiá»n</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let sp of selectedHoaDon.products; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td><img [src]="sp.image_url" height="40" /></td>
                        <td>
                          <svg [id]="'barcode-' + sp.product_code"></svg>
                          <div style="font-size: 12px; margin-top: 2px;">{{ sp.product_code }}</div>
                        </td>
                        <td>{{ sp.product_name }}</td>
                        <td>{{ sp.product_type }}</td>
                        <td>{{ sp.unit }}</td>
                        <td>{{ sp.weight }} kg</td>
                        <td>{{ sp.area }} mÂ²</td>
                        <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                        <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>
                        <td>{{ sp.quantity }}</td>
                        <td>{{ sp.unit_price | number }}</td>
                        <td>{{ sp.total_price | number }}</td>
                      </tr>
                    </tbody>
                  </table>

                  <div class="total-amount">
                    <strong>ğŸ’° Tá»•ng cá»™ng:</strong> {{ selectedHoaDon.total_amount | number:'1.0-0' }} VNÄ
                  </div>
                  </div>

                  <div style="text-align: right; margin-top: 12px;">
                    <div class="btn-wrapper" style="text-align: right; margin-top: 12px;">
                      <button class="btn-export" (click)="xuatHoaDonNhap(selectedHoaDon)">
                        ğŸ§¾ Xuáº¥t hÃ³a Ä‘Æ¡n
                      </button>
                      <span 
                        *ngIf="selectedHoaDon.trang_thai === 'ÄÃ£ duyá»‡t' && !selectedHoaDon.daXuatHoaDon" 
                        class="badge-corner">!</span>
                    </div>
                    &nbsp;
                  </div>
                  </ng-container>

<!---------------------------- Chi tiáº¿t PHIáº¾U XUáº¤T ---------------------------->
                  <ng-template #chiTietXuat>
                    <button class="btn-close-top" (click)="dongChiTiet()">âœ–</button>
                    <div id="hoa-don-xuat-pdf">
                    <h3>ğŸ“‹ MÃ£ Ä‘Æ¡n xuáº¥t kho: {{ selectedHoaDon.receipt_code }}</h3>

                    <h3>PHIáº¾U XUáº¤T KHO - WAREHOUSE MANAGER T&H</h3>

                    <!-- ğŸ”µ Thanh tráº¡ng thÃ¡i -->
                    <!-- ğŸ”µ Thanh tráº¡ng thÃ¡i kiá»ƒu cháº¥m trÃ²n hiá»‡n Ä‘áº¡i -->
                    <div class="timeline-container">
                      <div class="timeline">
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ÄÃ£ gá»­i phiáº¿u')">
                          <div class="circle">1</div>
                          <span>ÄÃ£ gá»­i phiáº¿u</span>
                        </div>
                        <div class="line"></div>
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ÄÃ£ duyá»‡t')">
                          <div class="circle">2</div>
                          <span>ÄÃ£ duyá»‡t</span>
                        </div>
                        <div class="line"></div>
                        <div class="step" [ngClass]="getStepClass(selectedHoaDon.trang_thai, 'ÄÃ£ nháº­p hÃ ng vÃ o kho')">
                          <div class="circle">3</div>
                          <span>ÄÃ£ xuáº¥t hÃ ng khá»i kho</span>
                        </div>
                      </div>
                    </div>

                    <!-- Thá»i gian & NCC -->
                    <div class="info-row">
                      <div class="info-section">
                        <h5>â± Thá»i gian</h5>
                        <p><strong>ğŸ“… NgÃ y táº¡o:</strong> {{ selectedHoaDon.created_date | date:'dd/MM/yyyy' }}</p>
                        <p><strong>ğŸ—“ï¸ NgÃ y háº¹n:</strong> 
                          {{ selectedHoaDon.delivery_date ? (selectedHoaDon.delivery_date| date:'dd/MM/yyyy') : 'ChÆ°a cÃ³' }}
                        </p>
                      </div>
                      <div class="info-section">
                        <h5>ğŸ¢ ThÃ´ng tin bÃªn nháº­n hÃ ng</h5>
                        <p><strong>ğŸï¸ Logo:</strong></p>
                        <img [src]="selectedHoaDon.logo_url" height="40" *ngIf="selectedHoaDon.logo_url" />
                        <p><strong>ğŸ‘¤ TÃªn doanh nghiá»‡p/trung tÃ¢m thÆ°Æ¡ng máº¡i, ... :</strong> <br>{{ selectedHoaDon.receiver_name }}</p>
                        <p><strong>ğŸ“ Äá»‹a chá»‰ doanh nghiá»‡p/trung tÃ¢m thÆ°Æ¡ng máº¡i, ... :</strong> <br> {{ selectedHoaDon.receiver_address }}</p>
                        <p><strong>ğŸ‘¤ Há» vÃ  tÃªn ngÆ°á»i nháº­n:</strong> {{ selectedHoaDon.representative_name }}</p>
                        <p><strong>ğŸ“§ Email:</strong> {{ selectedHoaDon.representative_email }}</p>
                        <p><strong>ğŸ“§ Sá»‘ Ä‘iá»‡n thoáº¡i:</strong> {{ selectedHoaDon.representative_phone}}</p>
                      </div>
                    </div>
                    
                    <!-- Quáº£n lÃ½ vÃ  ghi chÃº-->
                    <div class="info-row">
                      <div class="info-section">
                        <h5>ğŸ‘¨â€ğŸ’¼ NhÃ¢n viÃªn kiá»ƒm tra , duyá»‡t Ä‘Æ¡n</h5>
                        <p><strong>ğŸ‘¨ NhÃ¢n viÃªn:</strong> {{ selectedHoaDon.staff_account_name || 'ChÆ°a cÃ³' }}</p>
                        <p><strong>ğŸ“§ Email:</strong> {{ selectedHoaDon.staff_account_email || 'ChÆ°a cÃ³' }}</p>
                        <p><strong>ğŸ‘¨ Quáº£n lÃ½ kho:</strong> {{ selectedHoaDon.admin_account_name || 'ChÆ°a cÃ³' }}</p>
                        <p><strong>ğŸ“§ Email:</strong> {{ selectedHoaDon.admin_account_email || 'ChÆ°a cÃ³' }}</p>
                      </div>
                      <div class="info-section">
                        <h5>ğŸ“ Ghi chÃº & Pháº£n há»“i</h5>
                        <p><strong>ğŸ“ Ghi chÃº:</strong> {{ selectedHoaDon.note }}</p>
                        <p><strong>ğŸ’¬ Pháº£n há»“i tá»« kho:</strong> {{ selectedHoaDon.note_admin }}</p>
                      </div>
                    </div>

                    <!-- Danh sÃ¡ch sáº£n pháº©m xuáº¥t -->
                    <h4>ğŸ“¦ Danh sÃ¡ch sáº£n pháº©m</h4>
                    <table class="detail-table">
                      <thead>
                        <tr>
                          <th>STT</th>
                          <th>HÃ¬nh áº£nh</th>
                          <th>MÃ£ SP</th>
                          <th>TÃªn SP</th>
                          <th>Loáº¡i</th>
                          <th>ÄÆ¡n vá»‹</th>
                          <th>Khá»‘i lÆ°á»£ng</th>
                          <th>NSX</th>
                          <th>HSD</th>
                          <th>Sá»‘ lÆ°á»£ng</th>
                          <th>ÄÆ¡n giÃ¡</th>
                          <th>ThÃ nh tiá»n</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let sp of selectedHoaDon.products; let i = index">
                          <td>{{ i + 1 }}</td>
                          <td><img [src]="sp.image_url" height="40" /></td>
                          <td>
                            <svg [id]="'barcode-' + sp.product_code"></svg>
                            <div style="font-size: 12px; margin-top: 2px;">{{ sp.product_code }}</div>
                          </td>
                          <td>{{ sp.product_name }}</td>
                          <td>{{ sp.product_type }}</td>
                          <td>{{ sp.unit }}</td>
                          <td>{{ sp.weight }} kg</td>
                          <td>{{ sp.manufacture_date | date:'dd/MM/yyyy' }}</td>
                          <td>{{ sp.expiry_date | date:'dd/MM/yyyy' }}</td>
                          <td>{{ sp.quantity }}</td>
                          <td>{{ sp.unit_price | number:'1.0-0' }}</td>
                          <td>{{ sp.total_price | number:'1.0-0' }}</td>
                        </tr>
                      </tbody>
                    </table>

                    <div class="total-weight">
                      <strong>Tá»•ng trá»ng lÆ°á»£ng Ä‘Æ¡n hÃ ng:</strong> {{ selectedHoaDon.total_weight | number:'1.0-0' }} KG
                    </div>

                    <!-- Tá»•ng cá»™ng -->
                    <div class="total-amount">
                      <strong>Tá»•ng cá»™ng:</strong> {{ selectedHoaDon.total_amount | number:'1.0-0' }} VNÄ
                    </div>
                    </div>
                      

                    <br>


                    <div style="text-align: right; margin-top: 12px;">
                    <div class="btn-wrapper" style="text-align: right; margin-top: 12px;">
                      <button class="btn-export" (click)="xuatHoaDonXuat(selectedHoaDon)">
                        ğŸ§¾ Xuáº¥t hÃ³a Ä‘Æ¡n
                      </button>
                      <span 
                        *ngIf="selectedHoaDon.trang_thai === 'ÄÃ£ duyá»‡t' && !selectedHoaDon.daXuatHoaDon" 
                        class="badge-corner">!</span>
                    </div>
                    &nbsp;
                  </div>


                  </ng-template>

                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
    
</div>